// src/utils/studentAnalysis.js

export const generateStudentReport = (studentName, studentGradesObj) => {
    // 1. –ü–µ—Ä–µ—Ç–≤–æ—Ä—é—î–º–æ –æ–±'—î–∫—Ç –æ—Ü—ñ–Ω–æ–∫ {date: value} –≤ –º–∞—Å–∏–≤
    const entries = Object.values(studentGradesObj || {});

    // –§—ñ–ª—å—Ç—Ä—É—î–º–æ —á–∏—Å—Ç–æ –æ—Ü—ñ–Ω–∫–∏ (—á–∏—Å–ª–∞)
    const grades = entries
        .map(v => parseInt(v))
        .filter(v => !isNaN(v));

    // –§—ñ–ª—å—Ç—Ä—É—î–º–æ –ø—Ä–æ–ø—É—Å–∫–∏
    const absences = entries.filter(v => ["–Ω", "–ù"].includes(v)).length;

    // 2. –†–∞—Ö—É—î–º–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    const count = grades.length;
    const average = count > 0
        ? (grades.reduce((a, b) => a + b, 0) / count).toFixed(1)
        : 0;

    // 3. –ê–Ω–∞–ª—ñ–∑ –¥–∏–Ω–∞–º—ñ–∫–∏ (–ø–æ—Ä—ñ–≤–Ω—é—î–º–æ –ø–æ—á–∞—Ç–æ–∫ —ñ –∫—ñ–Ω–µ—Ü—å)
    let trend = "—Å—Ç–∞–±—ñ–ª—å–Ω–∞";
    if (count >= 2) {
        const firstHalf = grades.slice(0, Math.floor(count / 2));
        const secondHalf = grades.slice(Math.floor(count / 2));

        const avg1 = firstHalf.reduce((a, b) => a + b, 0) / firstHalf.length;
        const avg2 = secondHalf.reduce((a, b) => a + b, 0) / secondHalf.length;

        if (avg2 > avg1 + 1) trend = "–ø–æ–∑–∏—Ç–∏–≤–Ω–∞ üìà (—É—Å–ø—ñ—à–Ω—ñ—Å—Ç—å –∑—Ä–æ—Å—Ç–∞—î)";
        else if (avg2 < avg1 - 1) trend = "–Ω–µ–≥–∞—Ç–∏–≤–Ω–∞ üìâ (–ø–æ—Ç—Ä—ñ–±–Ω–∞ —É–≤–∞–≥–∞)";
    }

    // 4. –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —Ç–µ–∫—Å—Ç—É (–®–∞–±–ª–æ–Ω)
    let summary;
    if (average >= 10) summary = "–¥–µ–º–æ–Ω—Å—Ç—Ä—É—î –≤–∏—Å–æ–∫–∏–π —Ä—ñ–≤–µ–Ω—å –∑–Ω–∞–Ω—å, –∞–∫—Ç–∏–≤–Ω–æ –ø—Ä–∞—Ü—é—î –Ω–∞ —É—Ä–æ–∫–∞—Ö.";
    else if (average >= 7) summary = "–∑–∞—Å–≤–æ—é—î –º–∞—Ç–µ—Ä—ñ–∞–ª –Ω–∞ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ–º—É —Ä—ñ–≤–Ω—ñ, –∞–ª–µ –º–∞—î –ø–æ—Ç–µ–Ω—Ü—ñ–∞–ª –¥–ª—è –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è.";
    else if (average >= 4) summary = "–ø–æ—Ç—Ä–µ–±—É—î –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —É–≤–∞–≥–∏ —Ç–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è –±–∞–∑–æ–≤–∏—Ö —Ç–µ–º.";
    else summary = "–º–∞—î –∑–Ω–∞—á–Ω—ñ —Ç—Ä—É–¥–Ω–æ—â—ñ —ñ–∑ –∑–∞—Å–≤–æ—î–Ω–Ω—è–º –º–∞—Ç–µ—Ä—ñ–∞–ª—É.";

    const absenceText = absences === 0
        ? "–ü—Ä–æ–ø—É—Å–∫–∏ —É—Ä–æ–∫—ñ–≤ –≤—ñ–¥—Å—É—Ç–Ω—ñ."
        : `–ú–∞—î ${absences} –ø—Ä–æ–ø—É—Å–∫(—ñ–≤).`;

    // 5. –ó–±–∏—Ä–∞—î–º–æ —Ñ—ñ–Ω–∞–ª—å–Ω–∏–π —Ç–µ–∫—Å—Ç
    return `–•–ê–†–ê–ö–¢–ï–†–ò–°–¢–ò–ö–ê –£–°–ü–Ü–®–ù–û–°–¢–Ü
–£—á–µ–Ω—å: ${studentName}

–ó–∞–≥–∞–ª—å–Ω–∏–π –æ–≥–ª—è–¥:
${studentName} ${summary}
–ü–æ—Ç–æ—á–Ω–∏–π —Å–µ—Ä–µ–¥–Ω—ñ–π –±–∞–ª —Å–∫–ª–∞–¥–∞—î ${average}. –î–∏–Ω–∞–º—ñ–∫–∞ —É—Å–ø—ñ—à–Ω–æ—Å—Ç—ñ ‚Äî ${trend}.

–í—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—ñ—Å—Ç—å:
${absenceText}

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:
${average < 7 ? "–†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –ø—Ä–∏–¥—ñ–ª–∏—Ç–∏ –±—ñ–ª—å—à–µ —É–≤–∞–≥–∏ –¥–æ–º–∞—à–Ω—ñ–º –∑–∞–≤–¥–∞–Ω–Ω—è–º —Ç–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –Ω–∞ —É—Ä–æ–∫–∞—Ö." : "–ü—Ä–æ–¥–æ–≤–∂—É–≤–∞—Ç–∏ –Ω–∞–≤—á–∞–Ω–Ω—è –≤ —Ç–æ–º—É –∂ —Ç–µ–º–ø—ñ."}

–î–∞—Ç–∞: ${new Date().toLocaleDateString('uk-UA')}`;
};